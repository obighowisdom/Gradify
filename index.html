<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gradify</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="icon" type="image/x-icon" href="./logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./logo.png">
    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .container {
        max-width: 1000px;
      }

      .level-card {
        background: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }

      .level-header {
        background: #e9ecef;
        border-bottom: 1px solid #dee2e6;
        padding: 15px 20px;
        border-radius: 8px 8px 0 0;
      }

      .course-row {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        margin-bottom: 10px;
        padding: 10px;
      }

      .btn-custom {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
      }

      .btn-custom:hover {
        background-color: #5a6268;
        border-color: #545b62;
        color: white;
      }

      .btn-add {
        background-color: #adb5bd;
        border-color: #adb5bd;
        color: white;
      }

      .btn-add:hover {
        background-color: #9ca3a9;
        border-color: #9ca3a9;
        color: white;
      }

      .cgpa-display {
        background: linear-gradient(135deg, #e9ecef, #f8f9fa);
        border: 2px solid #dee2e6;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        margin-top: 20px;
      }

      .classification-display {
        background: #ffffff;
        border-radius: 8px;
        padding: 10px;
        margin: 10px 0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .form-control,
      .form-select {
        border: 1px solid #ced4da;
        background-color: #ffffff;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: #adb5bd;
        box-shadow: 0 0 0 0.2rem rgba(173, 181, 189, 0.25);
      }

      .delete-btn {
        background-color: #dc3545;
        border-color: #dc3545;
      }

      .delete-btn:hover {
        background-color: #c82333;
        border-color: #bd2130;
      }

      .btn-download {
        background-color: #28a745;
        border-color: #28a745;
        color: white;
      }

      .btn-download:hover {
        background-color: #218838;
        border-color: #1e7e34;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <div class="text-center mb-4">
        <div>
          <img src="./logo.png" width="200px" height="200px" alt="" />
        </div>
        <h1 class="display-4 text-secondary">CGPA Calculator</h1>
        <p class="lead text-muted">
          Organize your courses by level and calculate your CGPA
        </p>
      </div>

      <!-- Previous Academic Records Section -->
      <div class="card mb-4" style="background-color: #f8f9fa; border: 1px solid #dee2e6">
        <div class="card-body">
          <h5 class="card-title text-secondary">Previous Academic Records (Optional)</h5>
          <div class="row">
            <div class="col-md-4">
              <input
                type="number"
                id="previousPoints"
                class="form-control"
                placeholder="Previous Total Quality Points"
                min="0"
                step="0.01"
              />
            </div>
            <div class="col-md-4">
              <input
                type="number"
                id="previousCredits"
                class="form-control"
                placeholder="Previous Total Credits"
                min="0"
                step="1"
              />
            </div>
            <div class="col-md-4">
              <button class="btn btn-custom w-100" onclick="addPreviousRecords()">
                Add Previous Records
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Level Section -->
      <div class="card mb-4" style="background-color: #f8f9fa; border: 1px solid #dee2e6">
        <div class="card-body">
          <h5 class="card-title text-secondary">Add New Level</h5>
          <div class="row">
            <div class="col-md-8">
              <input
                type="text"
                id="levelName"
                class="form-control"
                placeholder="Enter level name (e.g., Year 1 Semester 1, Level 100)"
              />
            </div>
            <div class="col-md-4">
              <button class="btn btn-custom w-100" onclick="addLevel()">
                Add Level
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Levels Container -->
      <div id="levelsContainer"></div>

      <!-- CGPA Display -->
      <div class="cgpa-display">
        <h3 class="text-secondary mb-3">Your CGPA</h3>
        <h1 class="display-3 text-dark" id="cgpaValue">0.00</h1>
        <div id="classificationDisplay" class="classification-display">
          <span class="h4" id="classificationText"></span>
        </div>
        <p class="text-muted mt-2">
          Overall Cumulative Grade Point Average (5.0 Scale)
        </p>
        <div class="row mt-3">
          <div class="col-md-2">
            <small class="text-muted">Total Units</small>
            <div class="h5 text-secondary" id="totalCredits">0</div>
          </div>
          <div class="col-md-2">
            <small class="text-muted">Total Quality Points</small>
            <div class="h5 text-secondary" id="totalQualityPoints">0.00</div>
          </div>
          <div class="col-md-2">
            <small class="text-muted">Number of Courses</small>
            <div class="h5 text-secondary" id="totalCourses">0</div>
          </div>
          <div class="col-md-3">
            <button
              class="btn btn-custom btn-lg"
              onclick="calculateOverallCGPA()"
              style="margin-top: -5px"
            >
              Calculate CGPA
            </button>
          </div>
          <div class="col-md-3">
            <button
              class="btn btn-download btn-lg"
              onclick="downloadPDF()"
              style="margin-top: -5px"
              id="downloadBtn"
            >
              ðŸ“„ Download PDF
            </button>
          </div>
        </div>
      </div>
      <footer class="text-white py-6">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between px-4">
          <div class="flex items-center space-x-2">
            <div style="display: flex; justify-content: center;">
              <img src="./logo.png" width="80px" height="80px" alt="" />
            </div>
          </div>
          <p class="mt-2 md:mt-0 text-center md:text-right text-sm" style="color: black;">
            Created by <span class="font-bold" style="color: darkblue;">ENT302 Students 2025</span> at 
            <span class="font-semibold">The-Wise Innovation Hub</span>
          </p>
        </div>
      </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      let levels = {};
      let levelCounter = 0;
      let previousRecords = { points: 0, credits: 0 };

      // Score to Grade and GPA mapping (5.0 scale)
      function getGradeFromScore(score) {
        if (score >= 70) return { grade: "A", gpa: 5.0 };
        else if (score >= 60) return { grade: "B", gpa: 4.0 };
        else if (score >= 50) return { grade: "C", gpa: 3.0 };
        else if (score >= 45) return { grade: "D", gpa: 2.0 };
        else return { grade: "F", gpa: 0.0 };
      }

      // Function to get classification based on CGPA
      function getClassification(cgpa) {
        if (cgpa >= 4.5 && cgpa <= 5.0) {
          return { text: "First Class", class: "text-success" };
        } else if (cgpa >= 3.5 && cgpa < 4.5) {
          return { text: "Second Class Upper", class: "text-primary" };
        } else if (cgpa >= 2.5 && cgpa < 3.5) {
          return { text: "Second Class Lower", class: "text-info" };
        } else if (cgpa >= 1.5 && cgpa < 2.5) {
          return { text: "Third Class", class: "text-warning" };
        } else if (cgpa >= 1.0 && cgpa < 1.5) {
          return { text: "Passed", class: "text-secondary" };
        } else {
          return { text: "No Classification", class: "text-muted" };
        }
      }

      function addPreviousRecords() {
        const points = parseFloat(document.getElementById("previousPoints").value) || 0;
        const credits = parseInt(document.getElementById("previousCredits").value) || 0;

        if (points < 0 || credits < 0) {
          alert("Previous points and credits must be non-negative");
          return;
        }

        previousRecords = { points, credits };
        document.getElementById("previousPoints").value = "";
        document.getElementById("previousCredits").value = "";
        updateCalculations();
      }

      function addLevel() {
        const levelName = document.getElementById("levelName").value.trim();
        if (!levelName) {
          alert("Please enter a level name");
          return;
        }

        levelCounter++;
        const levelId = "level_" + levelCounter;

        levels[levelId] = {
          name: levelName,
          courses: {},
        };

        createLevelCard(levelId, levelName);
        document.getElementById("levelName").value = "";
      }

      function createLevelCard(levelId, levelName) {
        const levelsContainer = document.getElementById("levelsContainer");

        const levelCard = document.createElement("div");
        levelCard.className = "level-card";
        levelCard.id = levelId;

        levelCard.innerHTML = `
                <div class="level-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 text-secondary">${levelName}</h4>
                        <button class="btn btn-sm delete-btn" onclick="deleteLevel('${levelId}')">Delete Level</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Course Code" id="${levelId}_courseCode">
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" placeholder="Units" min="1" max="10" id="${levelId}_credits">
                        </div>
                        <div class="col-md-3">
                            <input type="number" class="form-control" placeholder="Score (0-100)" min="0" max="100" id="${levelId}_score">
                            <small class="text-muted">A: 70-100, B: 60-69, C: 50-59, D: 45-49, F: 0-44</small>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-add w-100" onclick="addCourse('${levelId}')">Add Course</button>
                        </div>
                    </div>
                    <div id="${levelId}_courses"></div>
                    <div class="mt-3 p-3" style="background-color: #e9ecef; border-radius: 6px;">
                        <div class="row text-center">
                            <div class="col-md-4">
                                <small class="text-muted">Level GPA</small>
                                <div class="h5 text-secondary" id="${levelId}_gpa">0.00</div>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted">Total Credits</small>
                                <div class="h5 text-secondary" id="${levelId}_totalCredits">0</div>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted">Courses</small>
                                <div class="h5 text-secondary" id="${levelId}_courseCount">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        levelsContainer.appendChild(levelCard);
      }

      function addCourse(levelId) {
        const courseCode = document
          .getElementById(levelId + "_courseCode")
          .value.trim();
        const credits = parseInt(
          document.getElementById(levelId + "_credits").value
        );
        const score = parseFloat(
          document.getElementById(levelId + "_score").value
        );

        if (!courseCode || !credits || score === null || isNaN(score)) {
          alert("Please fill in all course details");
          return;
        }

        if (credits < 1 || credits > 10) {
          alert("Credits must be between 1 and 10");
          return;
        }

        if (score < 0 || score > 100) {
          alert("Score must be between 0 and 100");
          return;
        }

        const gradeInfo = getGradeFromScore(score);
        const courseId = Date.now().toString();

        levels[levelId].courses[courseId] = {
          code: courseCode,
          credits: credits,
          score: score,
          grade: gradeInfo.grade,
          gpa: gradeInfo.gpa,
        };

        displayCourse(
          levelId,
          courseId,
          courseCode,
          credits,
          score,
          gradeInfo.grade
        );

        clearCourseInputs(levelId);
        updateCalculations();
      }

      function displayCourse(
        levelId,
        courseId,
        courseCode,
        credits,
        score,
        grade
      ) {
        const coursesContainer = document.getElementById(levelId + "_courses");

        const courseDiv = document.createElement("div");
        courseDiv.className = "course-row";
        courseDiv.id = courseId;

        const gradeInfo = getGradeFromScore(score);
        let badgeClass = "bg-success";
        if (grade === "B") badgeClass = "bg-primary";
        else if (grade === "C") badgeClass = "bg-warning";
        else if (grade === "D") badgeClass = "bg-secondary";
        else if (grade === "F") badgeClass = "bg-danger";

        courseDiv.innerHTML = `
                <div class="row align-items-center">
                    <div class="col-md-3">
                        <strong>${courseCode}</strong>
                    </div>
                    <div class="col-md-2">
                        <span class="badge bg-secondary">${credits} Credits</span>
                    </div>
                    <div class="col-md-2">
                        <span class="badge bg-info">${score}%</span>
                    </div>
                    <div class="col-md-2">
                        <span class="badge ${badgeClass}">${grade}</span>
                    </div>
                    <div class="col-md-1">
                        <span class="text-muted">${gradeInfo.gpa.toFixed(
                          1
                        )}</span>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-sm delete-btn" onclick="deleteCourse('${levelId}', '${courseId}')">Delete</button>
                    </div>
                </div>
            `;

        coursesContainer.appendChild(courseDiv);
      }

      function clearCourseInputs(levelId) {
        document.getElementById(levelId + "_courseCode").value = "";
        document.getElementById(levelId + "_credits").value = "";
        document.getElementById(levelId + "_score").value = "";
      }

      function deleteCourse(levelId, courseId) {
        delete levels[levelId].courses[courseId];
        document.getElementById(courseId).remove();
        updateCalculations();
      }

      function deleteLevel(levelId) {
        if (
          confirm(
            "Are you sure you want to delete this entire level and all its courses?"
          )
        ) {
          delete levels[levelId];
          document.getElementById(levelId).remove();
          updateCalculations();
        }
      }

      function calculateOverallCGPA() {
        updateCalculations();

        // Add visual feedback
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = "Calculated!";
        button.classList.add("btn-success");
        button.classList.remove("btn-custom");

        setTimeout(() => {
          button.textContent = originalText;
          button.classList.remove("btn-success");
          button.classList.add("btn-custom");
        }, 1500);

        // Scroll to CGPA display
        document.querySelector(".cgpa-display").scrollIntoView({
          behavior: "smooth",
          block: "center",
        });
      }

      function updateCalculations() {
        let totalQualityPoints = previousRecords.points;
        let totalCredits = previousRecords.credits;
        let totalCourses = 0;

        // Update each level
        for (let levelId in levels) {
          let levelQualityPoints = 0;
          let levelCredits = 0;
          let levelCourses = 0;

          for (let courseId in levels[levelId].courses) {
            const course = levels[levelId].courses[courseId];
            levelQualityPoints += course.gpa * course.credits;
            levelCredits += course.credits;
            levelCourses++;
          }

          const levelGPA =
            levelCredits > 0 ? levelQualityPoints / levelCredits : 0;

          // Update level display
          document.getElementById(levelId + "_gpa").textContent =
            levelGPA.toFixed(2);
          document.getElementById(levelId + "_totalCredits").textContent =
            levelCredits;
          document.getElementById(levelId + "_courseCount").textContent =
            levelCourses;

          // Add to totals
          totalQualityPoints += levelQualityPoints;
          totalCredits += levelCredits;
          totalCourses += levelCourses;
        }

        // Update overall CGPA
        const cgpa = totalCredits > 0 ? totalQualityPoints / totalCredits : 0;
        document.getElementById("cgpaValue").textContent = cgpa.toFixed(2);
        document.getElementById("totalCredits").textContent = totalCredits;
        document.getElementById("totalQualityPoints").textContent =
          totalQualityPoints.toFixed(2);
        document.getElementById("totalCourses").textContent = totalCourses;

        // Update classification display
        const classification = getClassification(cgpa);
        const classificationElement =
          document.getElementById("classificationText");
        classificationElement.textContent = classification.text;
        classificationElement.className = "h4 " + classification.class;

        // Show or hide classification display
        const classificationDisplay = document.getElementById(
          "classificationDisplay"
        );
        classificationDisplay.style.display = "block";
      }

      function downloadPDF() {
        // Check if there are any courses added
        let totalCourses = 0;
        for (let levelId in levels) {
          totalCourses += Object.keys(levels[levelId].courses).length;
        }

        if (totalCourses === 0 && previousRecords.credits === 0) {
          alert("Please add some courses or previous records before downloading the PDF!");
          return;
        }

        // Add visual feedback
        const button = document.getElementById("downloadBtn");
        const originalText = button.innerHTML;
        button.innerHTML = "ðŸ“„ Generating...";
        button.disabled = true;

        setTimeout(() => {
          generatePDF();
          button.innerHTML = originalText;
          button.disabled = false;
        }, 1000);
      }

      function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Get current date
        const currentDate = new Date().toLocaleDateString();
        
        // Get CGPA and classification
        const cgpa = document.getElementById("cgpaValue").textContent;
        const classification = document.getElementById("classificationText").textContent;
        const totalCredits = document.getElementById("totalCredits").textContent;
        const totalQualityPoints = document.getElementById("totalQualityPoints").textContent;
        const totalCourses = document.getElementById("totalCourses").textContent;

        // Header
        doc.setFontSize(20);
        doc.setTextColor(40, 40, 40);
        doc.text("CGPA Report", 105, 20, { align: "center" });
        
        doc.setFontSize(12);
        doc.setTextColor(100, 100, 100);
        doc.text("Generated by Gradify - Smart CGPA Calculator", 105, 28, { align: "center" });
        doc.text(`Generated on: ${currentDate}`, 105, 35, { align: "center" });

        // CGPA Summary
        doc.setFontSize(16);
        doc.setTextColor(40, 40, 40);
        doc.text("CGPA Summary", 20, 50);
        
        doc.setFontSize(12);
        doc.text(`Overall CGPA: ${cgpa} / 5.0`, 20, 65);
        doc.text(`Classification: ${classification}`, 20, 75);
        doc.text(`Total Units: ${totalCredits}`, 20, 85);
        doc.text(`Total Quality Points: ${totalQualityPoints}`, 20, 95);
        doc.text(`Total Courses: ${totalCourses}`, 20, 105);

        // Previous Records
        let yPosition = 125;
        if (previousRecords.credits > 0) {
          doc.setFontSize(14);
          doc.setTextColor(40, 40, 40);
          doc.text("Previous Academic Records", 20, yPosition);
          yPosition += 10;

          doc.setFontSize(10);
          doc.text(`Previous Quality Points: ${previousRecords.points.toFixed(2)}`, 20, yPosition);
          yPosition += 10;
          doc.text(`Previous Credits: ${previousRecords.credits}`, 20, yPosition);
          yPosition += 15;
        }

        // Courses by Level
        for (let levelId in levels) {
          const level = levels[levelId];
          const coursesInLevel = Object.keys(level.courses);
          
          if (coursesInLevel.length === 0) continue;

          // Level header
          doc.setFontSize(14);
          doc.setTextColor(40, 40, 40);
          doc.text(level.name, 20, yPosition);
          yPosition += 10;

          // Level GPA
          const levelGPA = document.getElementById(levelId + "_gpa").textContent;
          doc.setFontSize(10);
          doc.setTextColor(100, 100, 100);
          doc.text(`Level GPA: ${levelGPA}`, 20, yPosition);
          yPosition += 15;

          // Table headers
          doc.setFontSize(10);
          doc.setTextColor(40, 40, 40);
          doc.text("Course Code", 20, yPosition);
          doc.text("Units", 70, yPosition);
          doc.text("Score", 100, yPosition);
          doc.text("Grade", 130, yPosition);
          doc.text("GPA", 160, yPosition);
          yPosition += 5;

          // Table line
          doc.line(20, yPosition, 180, yPosition);
          yPosition += 10;

          // Course details
          doc.setFontSize(9);
          for (let courseId in level.courses) {
            const course = level.courses[courseId];
            
            doc.text(course.code, 20, yPosition);
            doc.text(course.credits.toString(), 70, yPosition);
            doc.text(course.score.toString() + "%", 100, yPosition);
            doc.text(course.grade, 130, yPosition);
            doc.text(course.gpa.toFixed(1), 160, yPosition);
            yPosition += 8;

            // Check if we need a new page
            if (yPosition > 270) {
              doc.addPage();
              yPosition = 20;
            }
          }

          yPosition += 10;

          // Check if we need a new page
          if (yPosition > 250) {
            doc.addPage();
            yPosition = 20;
          }
        }

        // Footer
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFontSize(8);
          doc.setTextColor(150, 150, 150);
          doc.text(`Page ${i} of ${pageCount}`, 105, 290, { align: "center" });
          doc.text("Generated by Gradify CGPA Calculator", 105, 295, { align: "center" });
        }

        // Save the PDF
        doc.save(`CGPA_Report_${cgpa}_${currentDate.replace(/\//g, '-')}.pdf`);
      }

      // Add some sample data for demonstration (optional)
      window.onload = function () {
        // You can uncomment these lines to add sample data
        /*
            document.getElementById('levelName').value = 'Year 1 Semester 1';
            addLevel();
            */
      };
    </script>
  </body>
</html>